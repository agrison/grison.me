<!DOCTYPE html>
<html lang="fr">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>grison.me - Article: Vim XML Indent on Windows</title>
  <link href="/media/javascripts/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <link rel="stylesheet" href="/media/style/grison.css" />
  <link rel="shortcut icon" type="image/png" href="/media/images/favicon.png"/>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js"></script>
  <script src="/media/javascripts/main.js" charset="utf-8"></script>
</head>

<body>

  <header> 
    <h1><a href="/"><span>@Autowired </span>Geek</a></h1>
    <h2>Alexandre Grison</h2>
    <nav> 
      <ul> 
        <li><a href="/">Blog</a></li>
        <li><a href="/categories">Categories</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/projects">Projects</a></li>
        <li><a href="/ego" class="ego">Ego</a></li>
      </ul> 
    </nav>
  </header>

  <div id="content">
	<div class="date">01-12 2011</div>
    <section class="posts">
<article>
<h1><a href="/2011/12/Vim-XML-Indent-on-Windows">Vim XML Indent on Windows</a></h1>

<p>Today I had some XML to check and I wanted to pretty format it inside gVim on my Windows 7 workstation. On Unix we've got <code>xmllint</code> who's able to pretty format XML content, but I did not have it on Windows.</p>

<p>I knew I could do something like <code>:%!xmllint</code> in Vim and bam it would work. All I was needing was that external program. Instead of searching on the web for a port from Cygwin or something else, I did write a little tiny xmllint in Java. After that I just had to create some <code>.bat</code> file in my <code>%PATH%</code> and it worked like a charm.</p>

<div class="highlight"><pre><code class="java"><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.logging.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.DocumentBuilderFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.w3c.dom.Document</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.InputSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.sun.org.apache.xml.internal.serialize.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Xmllint</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOG</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getAnonymousLogger</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">formatStdIn</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">LOG</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">,</span> <span class="s">&quot;Could not indent XML.&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="n">String</span> <span class="nf">formatStdIn</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">parseStdIn</span><span class="o">();</span>
        <span class="kd">final</span> <span class="n">OutputFormat</span> <span class="n">format</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OutputFormat</span><span class="o">(</span><span class="n">doc</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span> <span class="o">;</span>
        <span class="kd">final</span> <span class="n">Writer</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringWriter</span><span class="o">();</span>
        <span class="k">new</span> <span class="nf">XMLSerializer</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">format</span><span class="o">).</span><span class="na">serialize</span><span class="o">(</span><span class="n">doc</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="n">Document</span> <span class="nf">parseStdIn</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">InputSource</span> <span class="n">is</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputSource</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">().</span><span class="na">newDocumentBuilder</span><span class="o">().</span><span class="na">parse</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>This is no Ã¼bber-fancy Java, nothing hard to do, nor to understand. It should be possible to enhance it so that it performs better ()</p>

<p>I'm sure you know how to write a <code>.bat</code> file that will launch the Java program <span style="font-size: 20px">&#x263a;</span></p>

<div class="highlight"><pre><code class="java"><span class="nd">@ECHO</span> <span class="n">off</span>
<span class="n">java</span> <span class="n">Xmllint</span>
</code></pre>
</div>

<p>I did map the call to <code>xmllint</code> in my <code>vimrc</code> to the <code>F2</code> key with <code>map &lt;F2&gt; &lt;ESC&gt;:%!xmllint&lt;CR&gt;:setf xml&lt;CR&gt;</code>.</p>

<p>Before:
<p align="center"><img src="/media/images/vim1.png" alt="Vim" /></p></p>

<p>After:
<p align="center"><img src="/media/images/vim2.png" alt="Vim with pretty XML" /></p></p>

<p>I did a simple performance test, it's way behind <code>xmllint</code>, but it should suit my needs at least on Windows, especially for an implementation that took 5 minutes:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>wc sample.xml
    7712   26111  593764 sample.xml
<span class="nv">$ </span><span class="nb">time </span>cat sample.xml | java Xmllint
    real  0m1.109s
    user  0m1.317s
    sys   0m0.093s
<span class="nv">$ </span><span class="nb">time </span>xmllint --format sample.xml
   real  0m0.102s
   user  0m0.030s
   sys   0m0.016s
</code></pre>
</div>

<p>Enjoy your pretty XML in Vim on Windows <span style="font-size: 24px">&#x263a;</span></p>

</article>



<div id="disqus_thread"></div>

<script type="text/javascript">
    var disqus_shortname = 'grison';
    var disqus_identifier = '/2011/12/Vim-XML-Indent-on-Windows';
    var disqus_url = 'http://www.grison.me/2011/12/Vim-XML-Indent-on-Windows';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>


    </section>
  </div>

  <footer>
    <div class="about">Hey! I'm built using super-hype technologies <span style="font-size: 18px">&#x263a;</span></div>
    <div class="contact"><a href="#social" class="lsocial">Contact</a></div>
	<br/>
	<div id="social" style="clear: both;">
		<img src="/media/images/facebook.png" alt="Reach me on facebook" title="facebook" /> <a href="https://www.facebook.com/alexandre.grison">alexandre.grison</a> &nbsp;&mdash;&nbsp;
		<img src="/media/images/tw.png" alt="Follow me on twitter" title="twitter" /> <a href="http://twitter.com/#!/algrison">@algrison</a> &nbsp;&mdash;&nbsp; 
		<img src="/media/images/linkedin.png" alt="Buy me on linkedin" title="linkedin" /> <a href="http://fr.linkedin.com/pub/alexandre-grison/39/ba6/b56">alexandre grison</a> &nbsp;&mdash;&nbsp; 
		<img src="/media/images/github.png" alt="Browse me on Github" title="github" /> <a href="http://github.com/agrison">agrison</a> &nbsp;&mdash;&nbsp;
		<img src="/media/images/flickr.png" alt="View my awesomeness on Flickr" title="flickr" /> <a href="http://www.flickr.com/photos/agrison/">agrison</a>
	</div>
  </footer>
</body>
</html>
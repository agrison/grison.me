<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
	  <link rel="dns-prefetch" href="//fonts.googleapis.com" />
      <title>Peter Norvig's Did You Mean</title>
      <link rel="stylesheet" type="text/css" href="/media/css/style.css" />
      <link href='http://fonts.googleapis.com/css?family=Ubuntu:300,500,300italic' rel='stylesheet' />
      <script type="text/javascript" src="http://code.jquery.com/jquery.js"></script>
      <script type="text/javascript" src="/media/javascript/slider.js"></script>
      <script type="text/javascript" src="/media/javascript/main.js"></script>
      <style type="text/css">
      .content ul li { letter-spacing: 1px; }
      .content p { text-align: justify; font-size: 16px; }
      </style>
   </head>
   <body>
      <nav>
         <div id="logo">g</div>
         <h1>
            <span class="name">// Alexandre Grison</span><br/>
            <a href="/">@Autowired<br/><span>Geek blog;</span></a>
         </h1>

         <h2><a href="/">Home</a></h2>
         <h2>Code</h2>
         <ul>
            <li><a href="/jssg">Jssg</a></li>
            <li><a href="/jtoml">JTOML</a></li>
            <li><a href="/peculium">Peculium</a></li>
            <li><a href="/kree">Kree!</a></li>
            <li><a href="/legacy4j">Legacy4j</a></li>
            <li><a href="/ocamail">OCamail</a></li>
         </ul>
         <h2><a href="/photo">Photography</a></h2>
         <h2><a href="/ego">Ego</a></h2>
         <h2>Online</h2>
         <p id="online">
            <a href="http://twitter.com/#!/algrison"><img src="/media/images/icons/twitter.png" alt="twitter" /></a>
            <a href="https://www.facebook.com/alexandre.grison"><img src="/media/images/icons/facebook.png" alt="facebook" /></a>
            <a href="https://plus.google.com/114681009187194342514/posts"><img src="/media/images/icons/gplus.png" alt="google+" /></a>
            <br />
            <a href="http://fr.linkedin.com/pub/alexandre-grison/39/ba6/b56"><img src="/media/images/icons/linkedin.png" alt="linkedin" /></a>
            <a href="http://github.com/agrison"><img src="/media/images/icons/github.png" alt="github" /></a>
            <a href="http://www.flickr.com/photos/agrison"><img src="/media/images/icons/flickr.png" alt="flickr" /></a>
         </p>
      </nav>
      <div class="content">
        <span class="post-date" style="float: right">Dec 7, 2011</span>
         <h1 id="peter-norvig's-did-you-mean-?" id="Peter-Norvigs-Did-You-Mean-">Peter Norvig's Did You Mean ?</h1>

<p>Almost one year and a half ago, I did found something interesting on the web. An article of Peter Norvig explaining <a href="http://norvig.com/spell-correct.html">How to Write a Spelling Corrector</a>. At this time I found it brilliant and did implement it in OCaml (but lost it). I tried to shorten the provided Python version, and also the Java version made by <a href="http://raelcunha.com/spell-correct.php">Rael Cunha</a>. Eventually, I did come with a shortest version in both Java and Python. </p>

<p>A week ago I did get lost on gmail, and read the mail sent to both of them for I don't know what reason, and I thought I could post them here.</p>

<h1 id="python-3" id="Python-3">Python 3</h1>

<p>It uses <code>lambdas</code>, <code>string.ascii_lowercase</code>, <code>collections.Counter</code> and dict comprehension to reduce the number of lines to only 15, which is the lowest we can find on Peter Norvig's page, equals to <a href="http://pacman.blog.br/wiki/index.php?title=Um_Corretor_Ortogr%C3%A1fico_em_GAWK">Tiago "PacMan" Peczenyj &dash; Awk</a> and <a href="http://www.jelovic.com/weblog/?p=201">Dejan Jelovic &dash; F#</a> implementation.</p>

<p><pre class="highlight python"><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">string</span><span class="o">,</span> <span class="nn">collections</span>

<span class="n">load</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">txt</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'[a-z]+'</span><span class="p">,</span> <span class="n">txt</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
<span class="n">NWORDS</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">'big.txt'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">edits1</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
   <span class="n">splits</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
   <span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">splits</span> <span class="k">if</span> <span class="n">b</span><span class="p">]</span> <span class="o">+</span> <span class="c"># deletes</span>
              <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">splits</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="c"># transposes</span>
              <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">splits</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="k">if</span> <span class="n">b</span><span class="p">]</span> <span class="o">+</span> <span class="c"># replaces</span>
              <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">splits</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">])</span> <span class="c"># inserts</span>

<span class="n">edits2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">word</span><span class="p">:</span> <span class="p">{</span><span class="n">e2</span> <span class="k">for</span> <span class="n">e1</span> <span class="ow">in</span> <span class="n">edits1</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">e2</span> <span class="ow">in</span> <span class="n">edits1</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span> <span class="k">if</span> <span class="n">e2</span> <span class="ow">in</span> <span class="n">NWORDS</span><span class="p">}</span>

<span class="n">known</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">words</span><span class="p">:</span> <span class="p">{</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">NWORDS</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">correct</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
   <span class="n">candidates</span> <span class="o">=</span> <span class="n">known</span><span class="p">([</span><span class="n">word</span><span class="p">])</span> <span class="ow">or</span> <span class="n">known</span><span class="p">(</span><span class="n">edits1</span><span class="p">(</span><span class="n">word</span><span class="p">))</span> <span class="ow">or</span> <span class="n">edits2</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[</span><span class="n">word</span><span class="p">]</span>
   <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">NWORDS</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>

<span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="si">%s</span><span class="s"> -&gt; Did you mean </span><span class="si">%s</span><span class="s"> ?'</span> <span class="o">%</span> <span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">correct</span><span class="p">(</span><span class="n">arg</span><span class="p">)))</span>
</pre></p>

<p>Test and performance:
<pre class="highlight bash"><span class="nv">$ </span><span class="nb">time </span>python3 DidYouMean.py speling sujar roopm
speling -&gt; Did you mean spelling ?
sujar -&gt; Did you mean sugar ?
roopm -&gt; Did you mean room ?

real  0m2.030s
user  0m1.906s
sys   0m0.115s
</pre></p>

<h1 id="java" id="Java">Java</h1>

<p>The Java version is almost equivalent to the one of <a href="http://raelcunha.com/spell-correct.php">Rael Cunha</a>. But it uses a trick to read all the file in one line. This way, the program takes only 32 lines.</p>

<p><pre class="highlight java"><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">DidYouMean</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">nWords</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;();</span>
    
    <span class="kd">public</span> <span class="nf">DidYouMean</span><span class="o">(</span><span class="n">String</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">contents</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">file</span><span class="o">)).</span><span class="na">useDelimiter</span><span class="o">(</span><span class="s">&quot;\\Z&quot;</span><span class="o">).</span><span class="na">next</span><span class="o">();</span>
        <span class="n">Matcher</span> <span class="n">m</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">&quot;[a-z]+&quot;</span><span class="o">).</span><span class="na">matcher</span><span class="o">(</span><span class="n">contents</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">());</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">find</span><span class="o">())</span> <span class="n">nWords</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">(),</span> <span class="n">nWords</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">())</span> <span class="o">?</span> <span class="n">nWords</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">())</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">edits</span><span class="o">(</span><span class="n">String</span> <span class="n">w</span><span class="o">)</span> <span class="o">{</span>
    	<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">w</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">w</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">i</span><span class="o">)</span> <span class="o">+</span> <span class="n">w</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">));</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">w</span><span class="o">.</span><span class="na">length</span><span class="o">()-</span><span class="mi">1</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">w</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">i</span><span class="o">)</span> <span class="o">+</span> <span class="n">w</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="o">)</span> <span class="o">+</span> <span class="n">w</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="n">w</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="o">));</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">w</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="k">for</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">=</span><span class="sc">'a'</span><span class="o">;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">'z'</span><span class="o">;</span> <span class="o">++</span><span class="n">c</span><span class="o">)</span> <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">w</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">i</span><span class="o">)</span> <span class="o">+</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">c</span><span class="o">)</span> <span class="o">+</span> <span class="n">w</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">));</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">w</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="k">for</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">=</span><span class="sc">'a'</span><span class="o">;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">'z'</span><span class="o">;</span> <span class="o">++</span><span class="n">c</span><span class="o">)</span> <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">w</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">i</span><span class="o">)</span> <span class="o">+</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">c</span><span class="o">)</span> <span class="o">+</span> <span class="n">w</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kd">final</span> <span class="n">String</span> <span class="nf">correct</span><span class="o">(</span><span class="n">String</span> <span class="n">word</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">nWords</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">word</span><span class="o">))</span> <span class="k">return</span> <span class="n">word</span><span class="o">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">edits</span><span class="o">(</span><span class="n">word</span><span class="o">);</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">candidates</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="k">if</span><span class="o">(</span><span class="n">nWords</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">s</span><span class="o">))</span> <span class="n">candidates</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">nWords</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">s</span><span class="o">),</span><span class="n">s</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">candidates</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="k">return</span> <span class="n">candidates</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">candidates</span><span class="o">.</span><span class="na">keySet</span><span class="o">()));</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">w</span> <span class="o">:</span> <span class="n">edits</span><span class="o">(</span><span class="n">s</span><span class="o">))</span> <span class="k">if</span><span class="o">(</span><span class="n">nWords</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">w</span><span class="o">))</span> <span class="n">candidates</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">nWords</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">w</span><span class="o">),</span><span class="n">w</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">candidates</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">candidates</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">candidates</span><span class="o">.</span><span class="na">keySet</span><span class="o">()))</span> <span class="o">:</span> <span class="n">word</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">DidYouMean</span> <span class="n">sp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DidYouMean</span><span class="o">(</span><span class="s">&quot;big.txt&quot;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="nl">arg:</span> <span class="n">args</span><span class="o">)</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">arg</span> <span class="o">+</span> <span class="s">&quot; -&gt; Did you mean &quot;</span> <span class="o">+</span> <span class="n">sp</span><span class="o">.</span><span class="na">correct</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot; ?&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></p>

<p>Trying the Java version too:
<pre class="highlight bash"><span class="nv">$ </span><span class="nb">time </span>java DidYouMean speling sujar roopm
speling -&gt; Did you mean spelling ?
sujar -&gt; Did you mean sugar ?
roopm -&gt; Did you mean room ?

real  0m1.425s
user  0m1.695s
sys   0m0.154s
</pre></p>

<p>It can probably be shortened using third parties libraries, but the initial goal of Rael Cunha was to use only standard Java.</p>

<h1 id="ocaml" id="OCaml">OCaml</h1>

<p>Finally I wanted to start again on my previous OCaml version, but this time using <code>Batteries Included</code>. Here is what I finally come with, a 16 lines program, which implements the did you mean:
<pre class="highlight ocaml"><span class="c">(* Open Awesomeness *)</span>
<span class="k">open</span> <span class="nc">Batteries</span><span class="o">;;</span>
<span class="c">(* Read the content of the given file *)</span>
<span class="k">let</span> <span class="n">read_file</span> <span class="n">filename</span> <span class="o">=</span> <span class="nn">File</span><span class="p">.</span><span class="n">with_file_in</span> <span class="n">filename</span> <span class="nn">IO</span><span class="p">.</span><span class="n">read_all</span><span class="o">;;</span>
<span class="c">(* Extract all words *)</span>
<span class="k">let</span> <span class="n">words</span> <span class="o">=</span> <span class="nn">Str</span><span class="p">.</span><span class="n">split</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;[^a-zA-Z]+&quot;</span><span class="o">)</span> <span class="o">|-</span> <span class="nn">List</span><span class="p">.</span><span class="n">enum</span> <span class="o">|-</span> <span class="n">map</span> <span class="nn">String</span><span class="p">.</span><span class="n">lowercase</span><span class="o">;;</span>
<span class="c">(* Count word occurences *)</span>
<span class="k">let</span> <span class="n">train</span> <span class="n">tbl</span> <span class="o">=</span> <span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">w</span> <span class="o">-&gt;</span> <span class="k">let</span> <span class="n">prev</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">find_default</span> <span class="n">tbl</span> <span class="n">w</span> <span class="mi">0</span> <span class="k">in</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">replace</span> <span class="n">tbl</span> <span class="n">w</span> <span class="o">(</span><span class="n">prev</span> <span class="o">+</span> <span class="mi">1</span><span class="o">));;</span>
<span class="c">(* Construct the alphabet *)</span>
<span class="k">let</span> <span class="n">alphabet</span> <span class="o">=</span> <span class="o">[?</span> <span class="nc">List</span><span class="o">:</span><span class="nn">String</span><span class="p">.</span><span class="n">of_char</span><span class="o">(</span><span class="nn">Char</span><span class="p">.</span><span class="n">chr</span> <span class="n">i</span><span class="o">)</span> <span class="o">|</span> <span class="n">i</span> <span class="o">&lt;-</span> <span class="mi">97</span> <span class="o">--</span> <span class="mi">122</span> <span class="o">?];;</span>
<span class="c">(* Convenience functions *)</span>
<span class="k">let</span> <span class="o">(+..),</span> <span class="n">slice</span><span class="o">,</span> <span class="n">sub</span><span class="o">,</span> <span class="n">length</span> <span class="o">=</span> <span class="nn">Enum</span><span class="p">.</span><span class="n">append</span><span class="o">,</span> <span class="nn">String</span><span class="p">.</span><span class="n">slice</span><span class="o">,</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span><span class="o">,</span> <span class="nn">String</span><span class="p">.</span><span class="n">length</span><span class="o">;;</span>
<span class="c">(* the edits function *)</span>
<span class="k">let</span> <span class="n">edits</span> <span class="n">w</span> <span class="o">=</span> <span class="k">let</span> <span class="n">splits</span> <span class="n">w</span> <span class="o">=</span> <span class="o">[?</span> <span class="o">(</span><span class="n">slice</span> <span class="o">~</span><span class="n">last</span><span class="o">:</span><span class="n">i</span> <span class="n">w</span><span class="o">,</span> <span class="n">slice</span> <span class="o">~</span><span class="n">first</span><span class="o">:</span><span class="n">i</span> <span class="n">w</span><span class="o">)</span> <span class="o">|</span> <span class="n">i</span> <span class="o">&lt;-</span> <span class="mi">0</span> <span class="o">--</span> <span class="o">(</span><span class="n">length</span> <span class="n">w</span><span class="o">)</span> <span class="o">?]</span> <span class="k">in</span>
   <span class="o">[?</span> <span class="n">a</span><span class="o">^(</span><span class="n">slice</span> <span class="o">~</span><span class="n">first</span><span class="o">:</span><span class="mi">1</span> <span class="n">b</span><span class="o">)</span> <span class="o">|</span> <span class="n">a</span><span class="o">,</span><span class="n">b</span> <span class="o">&lt;-</span> <span class="n">splits</span> <span class="n">w</span><span class="o">;</span> <span class="n">b</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="o">?]</span> <span class="o">+..</span>
   <span class="o">[?</span> <span class="n">a</span><span class="o">^(</span><span class="n">sub</span> <span class="n">b</span> <span class="mi">1</span> <span class="mi">1</span><span class="o">)^(</span><span class="n">sub</span> <span class="n">b</span> <span class="mi">0</span> <span class="mi">1</span><span class="o">)^(</span><span class="n">slice</span> <span class="o">~</span><span class="n">first</span><span class="o">:</span><span class="mi">2</span> <span class="n">b</span><span class="o">)</span> <span class="o">|</span> <span class="n">a</span><span class="o">,</span><span class="n">b</span> <span class="o">&lt;-</span> <span class="n">splits</span> <span class="n">w</span><span class="o">;</span> <span class="n">length</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?]</span> <span class="o">+..</span>
   <span class="nn">Enum</span><span class="p">.</span><span class="n">flatten</span> <span class="o">[?</span> <span class="o">[?</span> <span class="n">a</span><span class="o">^</span><span class="n">c</span><span class="o">^(</span><span class="n">slice</span> <span class="o">~</span><span class="n">first</span><span class="o">:</span><span class="mi">1</span> <span class="n">b</span><span class="o">)</span> <span class="o">|</span> <span class="n">a</span><span class="o">,</span><span class="n">b</span> <span class="o">&lt;-</span> <span class="n">splits</span> <span class="n">w</span><span class="o">;</span> <span class="n">b</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="o">?]</span> <span class="o">|</span> <span class="n">c</span> <span class="o">&lt;-</span> <span class="o">(</span><span class="n">alphabet</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">enum</span><span class="o">)</span> <span class="o">?]</span> <span class="o">+..</span>
   <span class="nn">Enum</span><span class="p">.</span><span class="n">flatten</span> <span class="o">[?</span> <span class="o">[?</span> <span class="n">a</span><span class="o">^</span><span class="n">c</span><span class="o">^</span><span class="n">b</span> <span class="o">|</span> <span class="n">a</span><span class="o">,</span><span class="n">b</span> <span class="o">&lt;-</span> <span class="n">splits</span> <span class="n">w</span><span class="o">;</span> <span class="n">b</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="o">?]</span> <span class="o">|</span> <span class="n">c</span> <span class="o">&lt;-</span> <span class="o">(</span><span class="n">alphabet</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">enum</span><span class="o">)</span> <span class="o">?]</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">of_enum</span><span class="o">;;</span>
<span class="c">(* load the words *)</span>
<span class="k">let</span> <span class="n">known</span> <span class="o">=</span> <span class="k">let</span> <span class="n">model</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">create</span> <span class="mi">4096</span> <span class="k">in</span> <span class="s2">&quot;big.txt&quot;</span> <span class="o">|&gt;</span> <span class="n">read_file</span> <span class="o">|&gt;</span> <span class="o">(</span><span class="n">words</span> <span class="o">|-</span> <span class="n">train</span> <span class="n">model</span><span class="o">);</span>
   <span class="n">model</span> <span class="o">|&gt;</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">enum</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">of_enum</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">fast_sort</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(_,</span> <span class="n">c1</span><span class="o">)</span> <span class="o">(_,</span> <span class="n">c2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">compare</span> <span class="n">c2</span> <span class="n">c1</span><span class="o">);;</span>
<span class="c">(* correct a word*)</span>
<span class="k">let</span> <span class="n">correct</span> <span class="n">word</span> <span class="o">=</span> <span class="k">let</span> <span class="n">k</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">fst</span> <span class="n">known</span> <span class="k">in</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">w</span> <span class="o">-&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">index_of</span> <span class="n">w</span> <span class="n">k</span><span class="o">)</span> <span class="o">(</span><span class="n">edits</span> <span class="n">word</span><span class="o">)</span> 
   <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">remove_all</span><span class="o">)(</span><span class="nc">None</span><span class="o">)</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">min</span> <span class="o">|&gt;</span> <span class="nn">Option</span><span class="p">.</span><span class="n">get</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">at</span> <span class="n">known</span> <span class="o">|&gt;</span> <span class="n">fst</span><span class="o">;;</span>
<span class="c">(* try it *)</span>
<span class="o">#</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">correct</span> <span class="o">[</span><span class="s2">&quot;sward&quot;</span><span class="o">;</span> <span class="s2">&quot;sujar&quot;</span><span class="o">;</span> <span class="s2">&quot;speling&quot;</span><span class="o">;</span> <span class="s2">&quot;roopm&quot;</span><span class="o">];;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">string</span> <span class="kt">list</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;word&quot;</span><span class="o">;</span> <span class="s2">&quot;sugar&quot;</span><span class="o">;</span> <span class="s2">&quot;spelling&quot;</span><span class="o">;</span> <span class="s2">&quot;room&quot;</span><span class="o">]</span>
</pre></p>

<p>It's a bit verbose, even with the convenience functions for Enum appending, slicing and string operations. Without them we can reach the 15 lines, but then it becomes a mess to read.</p>

<p>It think it can be made faster by using a Hashtbl instead of a List in <code>known</code> and <code>correct</code>, because <code>List.index_of</code> takes some time to execute.</p>

<p>Enjoy <span style="font-size: 24px">&#x263a;</span></p>


      <div id="comments">
          <div id="disqus_thread"></div>
          <script type="text/javascript">
              var disqus_shortname = 'grison';
              var disqus_identifier = "/blog/Peter Norvig's Did You Mean";
              var disqus_url = 'http://www.grison.me/2011/12/07/Did-You-Mean';
              var disqus_developer = 1;
              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
         <div class="footer">Alexandre Grison &mdash; Generated using <a href="http://www.grison.me/jssg/">Jssg</a></div>      </div>
   </body>
</html>